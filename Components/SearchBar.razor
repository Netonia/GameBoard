@using LumexUI

<div class="bg-white p-4 rounded-lg shadow-md mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Search Input -->
        <div class="col-span-1 md:col-span-2">
            <input @bind="SearchTerm" 
                   @oninput="OnSearchChanged"
                   placeholder="Rechercher un jeu..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        
        <!-- Platform Filter -->
        <div>
            <select @bind="SelectedPlatform" @bind:event="onchange" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Toutes les plateformes</option>
                @foreach (var platform in Platforms)
                {
                    <option value="@platform">@platform</option>
                }
            </select>
        </div>
        
        <!-- Genre Filter -->
        <div>
            <select @bind="SelectedGenre" @bind:event="onchange" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Tous les genres</option>
                @foreach (var genre in Genres)
                {
                    <option value="@genre">@genre</option>
                }
            </select>
        </div>
    </div>
    
    <!-- Advanced Filters -->
    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Rating Filter -->
        <div class="flex items-center space-x-2">
            <label class="text-sm font-medium">Note minimale:</label>
            <input type="range" 
                   @bind="MinRating" 
                   @bind:event="onchange"
                   min="0" 
                   max="10" 
                   step="0.5" 
                   class="flex-1" />
            <span class="text-sm font-medium w-8">@MinRating.ToString("F1")</span>
        </div>
        
        <!-- Sort Options -->
        <div class="flex items-center space-x-2">
            <label class="text-sm font-medium">Trier par:</label>
            <select @bind="SortBy" @bind:event="onchange" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="title">Titre</option>
                <option value="date">Date</option>
                <option value="rating">Note</option>
                <option value="platform">Plateforme</option>
                <option value="genre">Genre</option>
            </select>
        </div>
        
        <!-- Sort Direction -->
        <div class="flex items-center space-x-2">
            <button @onclick="ToggleSortDirection" 
                    class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                @if (SortAscending)
                {
                    <span>↑ Croissant</span>
                }
                else
                {
                    <span>↓ Décroissant</span>
                }
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter] public List<string> Platforms { get; set; } = new();
    [Parameter] public List<string> Genres { get; set; } = new();
    [Parameter] public EventCallback<FilterCriteria> OnFiltersChanged { get; set; }

    private string _searchTerm = string.Empty;
    private string _selectedPlatform = string.Empty;
    private string _selectedGenre = string.Empty;
    private double _minRating = 0;
    private string _sortBy = "title";
    private bool _sortAscending = true;

    public string SearchTerm
    {
        get => _searchTerm;
        set 
        {
            _searchTerm = value;
            _ = NotifyFiltersChanged();
        }
    }

    public string SelectedPlatform
    {
        get => _selectedPlatform;
        set 
        {
            _selectedPlatform = value;
            _ = NotifyFiltersChanged();
        }
    }

    public string SelectedGenre
    {
        get => _selectedGenre;
        set 
        {
            _selectedGenre = value;
            _ = NotifyFiltersChanged();
        }
    }

    public double MinRating
    {
        get => _minRating;
        set 
        {
            _minRating = value;
            _ = NotifyFiltersChanged();
        }
    }

    public string SortBy
    {
        get => _sortBy;
        set 
        {
            _sortBy = value;
            _ = NotifyFiltersChanged();
        }
    }

    public bool SortAscending
    {
        get => _sortAscending;
        set => _sortAscending = value;
    }

    private async Task OnSearchChanged(ChangeEventArgs e)
    {
        SearchTerm = e.Value?.ToString() ?? string.Empty;
    }

    private async Task ToggleSortDirection()
    {
        SortAscending = !SortAscending;
        await NotifyFiltersChanged();
    }

    private async Task NotifyFiltersChanged()
    {
        var criteria = new FilterCriteria
        {
            SearchTerm = SearchTerm,
            Platform = SelectedPlatform,
            Genre = SelectedGenre,
            MinRating = MinRating > 0 ? MinRating : null,
            SortBy = SortBy,
            SortAscending = SortAscending
        };

        await OnFiltersChanged.InvokeAsync(criteria);
    }
}